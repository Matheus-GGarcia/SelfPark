<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Reserva Estacionamento Premium (Refatorado)</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <style>
        /* ðŸŽ¨ Design System: Cores e VariÃ¡veis */
        :root{
            --bg-dark: #0f1217; /* Fundo principal */
            --surface-dark: #1a1e26; /* SuperfÃ­cie de painÃ©is e cards */
            --text-white: #f0f3f6; /* Texto principal (Branco suave) */
            --muted-light: #9ea7b4; /* Texto secundÃ¡rio/sutil (Cinza claro) */
            
            --blue-accent: #3b82f6; /* Azul primÃ¡rio de destaque */
            --blue-accent-dark: #2563eb; /* Azul escuro (para gradientes) */
            --blue-light: rgba(59, 130, 246, 0.15); /* Azul translÃºcido */

            --glass: rgba(255,255,255,0.03);
            --card-shadow: 0 10px 30px rgba(0,0,0,0.6);
            --danger: #ef4444; /* Vermelho para aÃ§Ãµes perigosas */
            
            --radius-lg: 20px;
            --radius-md: 12px;
            --fw-800: 800;
            --fw-700: 700;
            --fw-600: 600;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
        }

        /* Base Reset & Typography */
        *{box-sizing:border-box}
        html,body{height:100%}
        body{
            margin:0;
            background: linear-gradient(180deg, var(--bg-dark) 0%, #050607 100%);
            color: var(--text-white);
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
            padding:28px;
        }
        
        /* Grid Principal */
        .app {
            max-width:1280px;
            margin:0 auto;
            display:grid;
            grid-template-columns: 1fr 420px;
            gap:32px;
            align-items:start;
        }

        /* Cards e PainÃ©is */
        .panel, .sidebar {
            background: var(--surface-dark);
            border-radius: var(--radius-lg);
            padding:24px;
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(255,255,255,0.08);
        }
        .sidebar {
            height: fit-content;
        }

        /* TÃ­tulo e NavegaÃ§Ã£o */
        .crumb {
            display:inline-flex;
            gap:10px;
            align-items:center;
            color:var(--muted-light);
            font-size:14px;
        }
        .title{
            font-size:32px;
            font-weight:var(--fw-800);
            margin-top:4px;
            letter-spacing: -0.5px;
        }

        /* Mapa (Placeholder) */
        .map {
            margin-top:24px;
            height:420px;
            border-radius:var(--radius-md);
            overflow:hidden;
            position:relative;
            /* Mock do mapa com o novo destaque azul */
            background:
                radial-gradient(circle at 20% 30%, var(--blue-light), transparent 8%),
                linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.0)),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="800" height="600"><rect width="100%" height="100%" fill="%231a1e26"/><g fill="%239ea7b4" font-family="Arial" font-size="16"><text x="40" y="40">Mapa - Mock (Azul)</text></g></svg>');
            background-size:cover;
            border: 1px solid rgba(255,255,255,0.06);
            box-shadow: inset 0 4px 30px rgba(0,0,0,0.6);
        }
        .map .loc {
            position:absolute;
            bottom:18px;
            left:18px;
            background: var(--surface-dark);
            color:var(--text-white);
            padding:12px 18px;
            border-radius:var(--radius-md);
            display:flex;
            gap:12px;
            align-items:center;
            box-shadow: 0 6px 20px rgba(0,0,0,0.7);
            border:1px solid rgba(255,255,255,0.08);
        }
        .loc .pin{
            width:44px;
            height:44px;
            border-radius:10px;
            background: linear-gradient(180deg,var(--blue-accent), var(--blue-accent-dark));
            display:flex;
            align-items:center;
            justify-content:center;
            font-weight:var(--fw-700);
            color:var(--text-white);
            box-shadow: 0 4px 10px rgba(59, 130, 246, 0.4);
        }
        .info-bar {
            margin-top:20px;
            display:flex;
            gap:16px;
            flex-wrap:wrap;
            align-items:center;
        }
        .info-card{
            background:rgba(255,255,255,0.03);
            padding:12px;
            border-radius:var(--radius-md);
            border:1px solid rgba(255,255,255,0.08);
            min-width:160px;
        }
        .info-label{ font-size:13px;color:var(--muted-light)}

        /* Sidebar: Descontos */
        .discounts{
            display:flex;
            gap:12px;
            margin-top:16px;
            flex-wrap:wrap;
        }
        .discount-card{
            background: rgba(255,255,255,0.05);
            border-radius:var(--radius-md);
            padding:14px;
            display:flex;
            gap:12px;
            align-items:center;
            flex:1;
            min-width:160px;
            border:1px solid rgba(255,255,255,0.08);
            cursor:pointer;
            transition: all .2s ease;
        }
        .discount-card:hover{
            background: rgba(255,255,255,0.08);
            transform: translateY(-2px);
        }
        .discount-card.active{
            background: var(--blue-light);
            box-shadow: 0 10px 20px var(--blue-light);
            border-color: var(--blue-accent-dark);
        }
        .discount-logo{
            background: linear-gradient(180deg, var(--blue-accent), var(--blue-accent-dark));
            width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;color:var(--text-white);
            font-weight:var(--fw-700);border:1px solid rgba(255,255,255,0.02);
        }
        .discount-percent{ margin-left:auto; color:var(--blue-accent); font-weight:var(--fw-700);}

        /* Controles de Data/Hora */
        .controls {
            margin-top:20px;
            display:grid;
            grid-template-columns: 1fr 1fr;
            gap:16px;
        }
        .control-card{
            background:rgba(255,255,255,0.05);
            border-radius:var(--radius-md);
            padding:14px;
            border:1px solid rgba(255,255,255,0.08);
        }
        .select{
            width:100%;
            padding:12px 14px;
            border-radius:10px;
            background:var(--bg-dark);
            border:1px solid rgba(255,255,255,0.1);
            color:var(--text-white);
            outline:none;
            font-size:15px;
            cursor:pointer;
            appearance: none; /* Remove seta padrÃ£o em selects */
            transition: border-color .15s ease;
        }
        .select:hover{ border-color: var(--blue-accent);}

        /* Calendar */
        .calendar {
            margin-top:16px;
            background: var(--surface-dark);
            border-radius:var(--radius-md);
            padding:16px;
            border:1px solid rgba(255,255,255,0.08);
        }
        .cal-head{
            display:flex;
            justify-content:space-between;
            align-items:center;
        }
        .cal-month{ font-weight:var(--fw-700); font-size:17px; color:var(--text-white);}
        .cal-btn{
            background:var(--surface-dark);
            border:1px solid rgba(255,255,255,0.1);
            color:var(--muted-light);
            width:30px;height:30px;
            border-radius:8px;
            cursor:pointer;
            font-size:18px;
            transition: all .15s ease;
        }
        .cal-btn:hover{ background: rgba(255,255,255,0.08); color:var(--text-white);}

        .weekdays{ display:grid; grid-template-columns: repeat(7,1fr); gap:6px; margin-top:12px; color:var(--muted-light); font-size:14px; text-align:center;}
        .days{ display:grid; grid-template-columns: repeat(7,1fr); gap:8px; margin-top:8px;}
        .day{
            height:42px;
            display:flex;
            align-items:center;
            justify-content:center;
            border-radius:8px;
            color:var(--muted-light);
            cursor:pointer;
            transition: all .15s ease;
            font-weight:var(--fw-600);
        }
        .day:not(.other):hover{ background: rgba(255,255,255,0.08);}
        .day.other{ opacity:0.3; cursor:default; pointer-events:none;}
        .day.selected{
            background: linear-gradient(180deg,var(--blue-accent), var(--blue-accent-dark));
            color:var(--text-white);
            font-weight:var(--fw-700);
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.2);
        }
        .day.in-range{
            background: var(--blue-light);
            color: var(--text-white);
        }

        /* Cupom */
        .coupon-row{
            margin-top:20px;
            display:flex;
            gap:10px;
            align-items:center;
        }
        .coupon-input{
            flex:1;
            padding:12px 14px;
            background:var(--bg-dark);border-radius:10px;border:1px solid rgba(255,255,255,0.1);color:var(--text-white);outline:none;
        }
        .apply-btn{
            background:var(--surface-dark);
            color:var(--blue-accent);
            padding:12px 18px;
            border-radius:10px;
            border:1px solid var(--blue-light);
            cursor:pointer;
            font-weight:var(--fw-700);
            transition: background .15s ease;
        }
        .apply-btn:hover{ background: var(--blue-light); }

        /* Resumo e BotÃ£o de Reserva */
        .summary{
            margin-top:24px;
            background: rgba(255,255,255,0.05);
            padding:16px;
            border-radius:var(--radius-md);
            border:1px solid rgba(255,255,255,0.08);
        }
        .price-row{ display:flex; justify-content:space-between; align-items:center; font-weight:var(--fw-700); font-size:18px; margin-bottom:10px;}
        .total{ font-size:24px; color:var(--blue-accent); font-weight:var(--fw-800);}
        .reserve-btn{
            margin-top:16px;
            width:100%;
            padding:16px;
            border-radius:40px;
            background: linear-gradient(90deg,var(--blue-accent), var(--blue-accent-dark));
            border:none;
            color:var(--text-white);
            font-weight:var(--fw-800);
            font-size:18px;
            cursor:pointer;
            box-shadow: 0 14px 38px rgba(59, 130, 246, 0.25);
            transition: transform .12s ease, box-shadow .12s ease;
        }
        .reserve-btn:hover{ transform: translateY(-3px); box-shadow: 0 20px 50px rgba(59, 130, 246, 0.3);}
        .hint{ color:var(--muted-light); font-size:13px; margin-top:8px;}

        /* Overlay de Loading (Circular Moderno) */
        .loading-overlay{
            position:fixed;
            inset:0;
            display:none;
            align-items:center;
            justify-content:center;
            background: rgba(0,0,0,0.8);
            z-index:1200;
        }
        .loading-box{
            width:160px;height:160px;border-radius:20px;background:var(--surface-dark);display:flex;align-items:center;justify-content:center;flex-direction:column;border:1px solid rgba(255,255,255,0.1);
            box-shadow: 0 18px 50px rgba(0,0,0,0.7);
        }
        .spinner{
            width:80px;height:80px;border-radius:50%;
            border:8px solid rgba(255,255,255,0.1);
            border-top-color: var(--blue-accent);
            animation: spin 1s linear infinite;
            box-shadow: 0 6px 24px var(--blue-light), inset 0 -6px 24px rgba(0,0,0,0.5);
        }
        @keyframes spin{ to{ transform: rotate(360deg); }}

        /* Toast (Feedback de Sucesso) */
        .toast{
            position:fixed;
            right:20px;
            bottom:20px;
            background: linear-gradient(90deg,var(--blue-accent), var(--blue-accent-dark));
            color:var(--text-white);
            padding:14px 20px;
            border-radius:12px;
            font-weight:var(--fw-700);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.2);
            transform: translateY(20px);
            opacity:0;
            transition: all .28s cubic-bezier(.2,.9,.3,1);
            z-index:1300;
        }
        .toast.show{ transform: translateY(0); opacity:1;}

        /* Responsive */
        @media (max-width: 980px){
            .app{ grid-template-columns: 1fr; padding-bottom:50px;}
            .map{ height:300px;}
            .sidebar{ order:2;}
            .panel{ order:1;}
            .controls{ grid-template-columns: 1fr;}
        }
    </style>
</head>
<body>

<div class="app" role="main" aria-labelledby="pageTitle">
    <section class="panel" aria-label="Detalhes do Estacionamento">
        <div class="header-title">
            <div>
                <div class="crumb" aria-label="NavegaÃ§Ã£o atual">ServiÃ§o â€¢ Estacionamento</div>
                <h1 id="pageTitle" class="title">Estacionamento Oficial Pacaembu</h1>
                <div class="info-bar" style="margin-top:12px;">
                    <div style="font-size:15px;color:var(--muted-light)">
                        <span aria-hidden="true">ðŸš¶</span> <span style="margin-left:8px">0 min a pÃ© atÃ© o local</span>
                    </div>
                    <div style="font-size:15px;color:var(--muted-light)"> â€¢ Vagas limitadas, reserve jÃ¡</div>
                </div>
            </div>
        </div>

        <div class="map" role="img" aria-label="LocalizaÃ§Ã£o do Estacionamento no mapa">
            <div class="loc" aria-hidden="true">
                <div class="pin">P</div>
                <div>
                    <div style="font-weight:var(--fw-700);font-size:16px">R. Capivari, 217</div>
                    <div style="color:var(--muted-light);font-size:14px">217 - Pacaembu, SÃ£o Paulo</div>
                </div>
            </div>
        </div>
        
        <div class="info-bar">
            <div class="info-card">
                <div class="info-label">Tipo de Vaga</div>
                <div style="font-weight:var(--fw-700)">Carro, Moto e PCD</div>
            </div>

            <div class="info-card" style="flex:1">
                <div class="info-label">Regras de Acesso</div>
                <div style="font-weight:var(--fw-600);color:var(--muted-light);font-size:14px">Apresente o QR Code da reserva na entrada do evento.</div>
            </div>
        </div>

    </section>

    <aside class="sidebar" aria-label="Interface de Reserva">
        <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
                <h3>Reserve sua vaga <span style="color:var(--blue-accent)">Online</span></h3>
                <div style="font-size:14px;color:var(--muted-light);margin-top:4px;">PreÃ§o exclusivo pelo site â€¢ Cancelamento flexÃ­vel</div>
            </div>
            <div style="text-align:right">
                <div class="info-label">Total estimado</div>
                <div style="font-weight:var(--fw-800);font-size:20px;color:var(--blue-accent)">R$ <span id="priceTop">160,00</span></div>
            </div>
        </div>

        <div class="discounts" role="list" aria-label="Descontos disponÃ­veis">
            <div class="discount-card" id="dporto" role="listitem" tabindex="0" aria-pressed="false" title="Ativar Desconto Porto Seguro -10%">
                <div class="discount-logo">PS</div>
                <div>
                    <div style="font-weight:var(--fw-600)">Porto Seguro</div>
                    <div class="info-label">VÃ¡lido para apÃ³lices</div>
                </div>
                <div class="discount-percent">-10%</div>
            </div>

            <div class="discount-card" id="dcupom" role="listitem" title="Aplicar cupom promocional" style="min-width:140px;">
                <div class="discount-logo">C</div>
                <div>
                    <div style="font-weight:var(--fw-600)">Cupom</div>
                    <div class="info-label">CÃ³digo promocional</div>
                </div>
                <div style="color:var(--muted-light);font-weight:var(--fw-700)">â€”</div>
            </div>
        </div>

        <div class="controls">
            <div class="control-card" aria-label="Data e Hora de Entrada">
                <div class="info-label">Entrada</div>
                <div style="display:flex;flex-direction:column;gap:10px;margin-top:8px;">
                    <button id="openCalIn" class="select" aria-haspopup="dialog" aria-controls="calendar" style="text-align:left">Selecionar data</button>
                    <select id="timeIn" class="select" aria-label="Hora de entrada"></select>
                </div>
            </div>

            <div class="control-card" aria-label="Data e Hora de SaÃ­da">
                <div class="info-label">SaÃ­da</div>
                <div style="display:flex;flex-direction:column;gap:10px;margin-top:8px;">
                    <button id="openCalOut" class="select" aria-haspopup="dialog" aria-controls="calendar" style="text-align:left">Selecionar data</button>
                    <select id="timeOut" class="select" aria-label="Hora de saÃ­da"></select>
                </div>
            </div>
        </div>

        <div class="calendar" id="calendar" role="dialog" aria-modal="false" aria-hidden="true" style="margin-top:20px;display:none;">
            <div class="cal-head">
                <div class="cal-month" id="calMonthLabel">â€”</div>
                <div class="cal-nav">
                    <button class="cal-btn" id="prevMonth" title="MÃªs anterior" aria-label="MÃªs anterior">â€¹</button>
                    <button class="cal-btn" id="nextMonth" title="PrÃ³ximo mÃªs" aria-label="PrÃ³ximo mÃªs">â€º</button>
                </div>
            </div>

            <div class="weekdays" aria-hidden="true">
                <div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>SÃ¡b</div>
            </div>

            <div class="days" id="daysGrid" aria-live="polite"></div>

            <div style="display:flex;gap:10px;margin-top:14px;align-items:center;justify-content:space-between">
                <div style="font-size:14px;color:var(--muted-light)">Selecione o perÃ­odo de reserva</div>
                <button id="clearRange" class="cal-btn" style="color:var(--danger);border-color:var(--danger)">Limpar Datas</button>
            </div>
        </div>

        <div class="coupon-row">
            <input id="couponInput" class="coupon-input" placeholder="CÃ³digo promocional (ex: ZUL10)" aria-label="CÃ³digo promocional">
            <button id="applyCoupon" class="apply-btn">Aplicar</button>
        </div>

        <div class="summary" aria-live="polite">
            <div class="price-row">
                <div>Subtotal (<span id="numDays">1</span> dia)</div>
                <div>R$ <span id="subtotal">160,00</span></div>
            </div>
            <div class="price-row" style="margin-bottom:12px;">
                <div>Descontos</div>
                <div style="color:var(--blue-accent)">- R$ <span id="discountVal">0,00</span></div>
            </div>
            <div class="price-row" style="border-top:1px dashed rgba(255,255,255,0.1);padding-top:12px;margin-top:6px;">
                <div>Total a Pagar</div>
                <div class="total">R$ <span id="totalPrice">160,00</span></div>
            </div>

            <button id="reserveBtn" class="reserve-btn">Garantir Minha Reserva</button>
            <div class="hint" style="text-align:center;">Pagamento via Pix ou CartÃ£o na hora da reserva.</div>
        </div>

    </aside>
</div>

<div class="loading-overlay" id="loadingOverlay" role="status" aria-hidden="true">
    <div class="loading-box" role="status" aria-live="polite">
        <div class="spinner" aria-hidden="true"></div>
        <div style="margin-top:16px;font-weight:var(--fw-700);color:var(--muted-light);font-size:14px">Processando a reserva...</div>
    </div>
</div>

<div class="toast" id="toast">Reserva confirmada â€” cÃ³digo #ZUL-12345</div>

<script>


/* =================================================================================
Â  Â ex.html â€” LÃ³gica consolidada: leitura da URL, calendÃ¡rio, horÃ¡rios, cÃ¡lculo e
Â  Â redirecionamento para confirmacao.html com todos os parÃ¢metros necessÃ¡rios.
Â  Â ================================================================================= */

(function () {
Â  // --- ConfiguraÃ§Ã£o / Estado ---
Â  const basePrice = 160.00;
Â  let activeDiscounts = { porto: false, coupon: 0, couponCode: null };
Â  let selected = { start: null, end: null, timeIn: "09:00", timeOut: "02:59" };
Â  window.globalDays = 1;
Â  window.globalTotal = basePrice;
Â  window.globalEventId = null;
Â  window.globalLocalId = null;
Â  window.globalTitle = null;
Â  window.globalImg = null;

Â  // --- DOM refs (expected in your HTML) ---
Â  const subtotalEl = document.getElementById('subtotal');
Â  const discountEl = document.getElementById('discountVal');
Â  const totalEl = document.getElementById('totalPrice');
Â  const priceTopEl = document.getElementById('priceTop');
Â  const numDaysEl = document.getElementById('numDays');
Â  const btnOpenIn = document.getElementById('openCalIn');
Â  const btnOpenOut = document.getElementById('openCalOut');
Â  const calendarEl = document.getElementById('calendar');
Â  const daysGrid = document.getElementById('daysGrid');
Â  const calMonthLabel = document.getElementById('calMonthLabel');
Â  const clearRangeBtn = document.getElementById('clearRange');
Â  const dPorto = document.getElementById('dporto');

Â  // --- Helpers ---
Â  function currency(v){ return Number(v).toLocaleString('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2}); }
Â  function startOfDay(d){ const n = new Date(d); n.setHours(0,0,0,0); return n; }
Â  function sameDay(a,b){ if(!a || !b) return false; return startOfDay(a).getTime() === startOfDay(b).getTime(); }
Â  function formatCompactDate(date) { if (!date) return "Selecionar data"; return date.toLocaleDateString('pt-BR', { day: '2-digit', month: 'short' }); }

Â  // --- Price calc (keeps original noon approach) ---
Â  function recalcPrice(){
Â  Â  let days = 1;
Â  Â  let subtotal = basePrice;

Â  Â  if(selected.start && selected.end){
Â  Â  Â  Â  const msPerDay = 24*60*60*1000;
Â  Â  Â  Â  const startDate = new Date(selected.start); startDate.setHours(12,0,0,0);
Â  Â  Â  Â  const endDate = new Date(selected.end); endDate.setHours(12,0,0,0);
Â  Â  Â  Â  days = Math.ceil((endDate - startDate) / msPerDay) + 1;
Â  Â  Â  Â  if(days < 1) days = 1;
Â  Â  Â  Â  subtotal = basePrice * days;
Â  Â  }

Â  Â  window.globalDays = days;

Â  Â  let discount = 0;
Â  Â  if(activeDiscounts.porto) discount += subtotal * 0.10;
Â  Â  if(activeDiscounts.couponCode === 'ZUL10') discount += subtotal * 0.10;
Â  Â  if(activeDiscounts.coupon > 0) discount += activeDiscounts.coupon;

Â  Â  let total = Math.max(0, subtotal - discount);

Â  Â  window.globalTotal = total;

Â  Â  if(subtotalEl) subtotalEl.textContent = currency(subtotal);
Â  Â  if(discountEl) discountEl.textContent = currency(discount);
Â  Â  if(totalEl) totalEl.textContent = currency(total);
Â  Â  if(priceTopEl) priceTopEl.textContent = currency(total);
Â  Â  if(numDaysEl) numDaysEl.textContent = days;
Â  }

Â  // --- URL parsing helpers ---
Â  function parseDateParam(raw){
Â  Â  if(!raw) return null;
Â  Â  if(/^\d{4}-\d{2}-\d{2}$/.test(raw)){
Â  Â  Â  Â  const d = new Date(raw + "T12:00:00");
Â  Â  Â  Â  if(!isNaN(d)) return d;
Â  Â  }
Â  Â  const tryIso = new Date(raw);
Â  Â  if (!isNaN(tryIso)) return tryIso;
Â  Â  return null;
Â  }

Â  function getUrlParams(){
Â  Â  const urlParams = new URLSearchParams(window.location.search);
Â  Â  return {
Â  Â  Â  eventId: urlParams.get('eventId'),
Â  Â  Â  localId: urlParams.get('localId'),
Â  Â  Â  title: urlParams.get('title'),
Â  Â  Â  img: urlParams.get('img'),
Â  Â  Â  entrada: urlParams.get('entrada'),
Â  Â  Â  saida: urlParams.get('saida'),
Â  Â  };
Â  }

Â  // --- Initialize from URL ---
Â  function initializeFromUrl(){
Â  Â  const p = getUrlParams();
Â  Â  window.globalEventId = p.eventId || null;
Â  Â  window.globalLocalId = p.localId || null;
Â  Â  window.globalTitle = p.title ? decodeURIComponent(p.title) : null;
Â  Â  window.globalImg = p.img ? decodeURIComponent(p.img) : null;

Â  Â  // if title or img available, you may want to render them in the UI; we'll update pageTitle if present
Â  Â  const pageTitle = document.getElementById('pageTitle');
Â  Â  if(pageTitle && window.globalTitle) pageTitle.textContent = window.globalTitle;

Â  Â  // entrada may be yyyy-mm-dd or ISO; prefer parseDateParam
Â  Â  if(p.entrada){
Â  Â  Â  Â  const entradaDate = parseDateParam(p.entrada);
Â  Â  Â  Â  if(entradaDate){
Â  Â  Â  Â  Â  Â  selected.start = startOfDay(entradaDate);
Â  Â  Â  Â  Â  Â  if(p.entrada.length > 10){
Â  Â  Â  Â  Â  Â  Â  Â  selected.timeIn = entradaDate.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit',hour12:false});
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  btnOpenIn && (btnOpenIn.textContent = formatCompactDate(entradaDate));
Â  Â  Â  Â  Â  Â  const timeInEl = document.getElementById('timeIn');
Â  Â  Â  Â  Â  Â  if(timeInEl) timeInEl.value = selected.timeIn;
Â  Â  Â  Â  }
Â  Â  }

Â  Â  if(p.saida){
Â  Â  Â  Â  const saidaDate = parseDateParam(p.saida);
Â  Â  Â  Â  if(saidaDate){
Â  Â  Â  Â  Â  Â  selected.end = startOfDay(saidaDate);
Â  Â  Â  Â  Â  Â  if(p.saida.length > 10){
Â  Â  Â  Â  Â  Â  Â  Â  selected.timeOut = saidaDate.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit',hour12:false});
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  btnOpenOut && (btnOpenOut.textContent = formatCompactDate(saidaDate));
Â  Â  Â  Â  Â  Â  const timeOutEl = document.getElementById('timeOut');
Â  Â  Â  Â  Â  Â  if(timeOutEl) timeOutEl.value = selected.timeOut;
Â  Â  Â  Â  }
Â  Â  }

Â  Â  recalcPrice();
Â  }

Â  // --- Discounts handlers ---
Â  if(dPorto){
Â  Â  dPorto.addEventListener('click', ()=> {
Â  Â  Â  Â  activeDiscounts.porto = !activeDiscounts.porto;
Â  Â  Â  Â  dPorto.classList.toggle('active', activeDiscounts.porto);
Â  Â  Â  Â  dPorto.setAttribute('aria-pressed', activeDiscounts.porto ? 'true' : 'false');
Â  Â  Â  Â  recalcPrice();
Â  Â  });
Â  }

Â  document.getElementById('applyCoupon')?.addEventListener('click', ()=> {
Â  Â  const code = document.getElementById('couponInput').value.trim().toUpperCase();
Â  Â  activeDiscounts.coupon = 0;
Â  Â  activeDiscounts.couponCode = null;

Â  Â  if(!code){
Â  Â  Â  Â  alert('Informe um cÃ³digo promocional.');
Â  Â  } else if(code === 'ZUL10'){
Â  Â  Â  Â  activeDiscounts.couponCode = 'ZUL10';
Â  Â  Â  Â  alert('Cupom ZUL10 aplicado: 10% de desconto adicional.');
Â  Â  } else if(code === 'ZUL20'){
Â  Â  Â  Â  activeDiscounts.coupon = 20.00;
Â  Â  Â  Â  alert('Cupom ZUL20 aplicado: R$20,00 de desconto fixo.');
Â  Â  } else {
Â  Â  Â  Â  alert('Cupom invÃ¡lido ou expirado.');
Â  Â  }
Â  Â  recalcPrice();
Â  });

Â  // --- Time selectors population ---
Â  function populateTimes(){
Â  Â  const timeIn = document.getElementById('timeIn');
Â  Â  const timeOut = document.getElementById('timeOut');
Â  Â  if(!timeIn || !timeOut) return;
Â  Â  const times = [];
Â  Â  for(let h=0; h<24; h++){
Â  Â  Â  Â  for(let m=0; m<60; m+=30){
Â  Â  Â  Â  Â  Â  times.push(`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`);
Â  Â  Â  Â  }
Â  Â  }
Â  Â  times.forEach(t => {
Â  Â  Â  Â  const o1 = document.createElement('option'); o1.value = t; o1.textContent = t;
Â  Â  Â  Â  const o2 = document.createElement('option'); o2.value = t; o2.textContent = t;
Â  Â  Â  Â  timeIn.appendChild(o1);
Â  Â  Â  Â  timeOut.appendChild(o2);
Â  Â  });

Â  Â  timeIn.value = selected.timeIn;
Â  Â  timeOut.value = selected.timeOut;
Â  Â  timeIn.addEventListener('change', ()=> { selected.timeIn = timeIn.value; recalcPrice(); });
Â  Â  timeOut.addEventListener('change', ()=> { selected.timeOut = timeOut.value; recalcPrice(); });
Â  }

Â  // --- Calendar (render / selection) ---
Â  let view = new Date();
Â  let selecting = null;

Â  btnOpenIn?.addEventListener('click', ()=> openCalendar('in'));
Â  btnOpenOut?.addEventListener('click', ()=> openCalendar('out'));
Â  document.getElementById('prevMonth')?.addEventListener('click', ()=>{ view.setMonth(view.getMonth()-1); renderCalendar(); });
Â  document.getElementById('nextMonth')?.addEventListener('click', ()=>{ view.setMonth(view.getMonth()+1); renderCalendar(); });

Â  clearRangeBtn?.addEventListener('click', ()=> {
Â  Â  selected.start = null;
Â  Â  selected.end = null;
Â  Â  btnOpenIn.textContent = "Selecionar data";
Â  Â  btnOpenOut.textContent = "Selecionar data";
Â  Â  recalcPrice();
Â  Â  renderCalendar();
Â  Â  closeCalendar();
Â  });

Â  function openCalendar(which){
Â  Â  selecting = which;
Â  Â  if(!calendarEl) return;
Â  Â  calendarEl.style.display = 'block';
Â  Â  calendarEl.setAttribute('aria-hidden','false');
Â  Â  if(which === 'in' && selected.start) view = new Date(selected.start);
Â  Â  if(which === 'out' && selected.end) view = new Date(selected.end);
Â  Â  calendarEl.scrollIntoView({behavior:'smooth'});
Â  Â  renderCalendar();
Â  }
Â  function closeCalendar(){
Â  Â  selecting = null;
Â  Â  if(!calendarEl) return;
Â  Â  calendarEl.style.display = 'none';
Â  Â  calendarEl.setAttribute('aria-hidden','true');
Â  }

Â  function renderCalendar(){
Â  Â  if(!daysGrid) return;
Â  Â  daysGrid.innerHTML = '';
Â  Â  const year = view.getFullYear();
Â  Â  const month = view.getMonth();
Â  Â  const today = startOfDay(new Date());
Â  Â  const first = new Date(year, month, 1);
Â  Â  const last = new Date(year, month+1, 0);
Â  Â  calMonthLabel.textContent = first.toLocaleDateString('pt-BR',{month:'long',year:'numeric'});
Â  Â  const startDay = first.getDay();
Â  Â  for(let i=0; i<startDay; i++){
Â  Â  Â  Â  const prev = new Date(first);
Â  Â  Â  Â  prev.setDate(prev.getDate() - (startDay - i));
Â  Â  Â  Â  const dayEl = document.createElement('div');
Â  Â  Â  Â  dayEl.className = 'day other';
Â  Â  Â  Â  dayEl.textContent = prev.getDate();
Â  Â  Â  Â  daysGrid.appendChild(dayEl);
Â  Â  }
Â  Â  for(let i=1; i<=last.getDate(); i++){
Â  Â  Â  Â  const date = startOfDay(new Date(year, month, i));
Â  Â  Â  Â  const dayEl = document.createElement('div');
Â  Â  Â  Â  dayEl.className = 'day';
Â  Â  Â  Â  dayEl.textContent = i;
Â  Â  Â  Â  dayEl.dataset.date = date.toISOString();
Â  Â  Â  Â  if(selected.start && selected.end){
Â  Â  Â  Â  Â  Â  if(date > selected.start && date < selected.end) dayEl.classList.add('in-range');
Â  Â  Â  Â  }
Â  Â  Â  Â  if(sameDay(date, selected.start)) dayEl.classList.add('selected');
Â  Â  Â  Â  if(sameDay(date, selected.end)) dayEl.classList.add('selected');
Â  Â  Â  Â  if(date < today && !sameDay(date,today)){
Â  Â  Â  Â  Â  Â  dayEl.classList.add('other');
Â  Â  Â  Â  Â  Â  dayEl.style.cursor = 'not-allowed';
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  dayEl.addEventListener('click', ()=> handleDayClick(date, dayEl));
Â  Â  Â  Â  }
Â  Â  Â  Â  daysGrid.appendChild(dayEl);
Â  Â  }
Â  }

Â  function handleDayClick(date){
Â  Â  if (selecting === 'in') {
Â  Â  Â  Â  selected.start = date;
Â  Â  Â  Â  if(selected.end && selected.end < selected.start) selected.end = null;
Â  Â  Â  Â  btnOpenIn.textContent = formatCompactDate(date);
Â  Â  } else if (selecting === 'out') {
Â  Â  Â  Â  if(!selected.start || date >= selected.start){
Â  Â  Â  Â  Â  Â  selected.end = date;
Â  Â  Â  Â  Â  Â  btnOpenOut.textContent = formatCompactDate(date);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  alert("A data de saÃ­da nÃ£o pode ser anterior Ã  data de entrada.");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  }
Â  Â  recalcPrice();
Â  Â  renderCalendar();
Â  Â  if(selected.start && selected.end) closeCalendar();
Â  }

Â  // --- Reserve / finalize (build URL and redirect to confirmacao.html) ---
Â  // VersÃ£o Original do usuÃ¡rio (adicionada aqui)
Â  function finalizarReserva() {
Â  Â  // --- VALIDAR DATAS E HORÃRIOS ---
Â  Â  if (!selected.start || !selected.end) {
Â  Â  Â  Â  alert("Selecione a data de entrada e saÃ­da.");
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  const timeIn = document.getElementById("timeIn").value;
Â  Â  const timeOut = document.getElementById("timeOut").value;

Â  Â  if (!timeIn || !timeOut) {
Â  Â  Â  Â  alert("Selecione o horÃ¡rio de entrada e saÃ­da.");
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  // Recalcula o preÃ§o para garantir que os valores de subtotal, desconto e total estejam atualizados
Â  Â  recalcPrice();
Â  Â  // OBS: O cÃ³digo anterior do bloco tinha uma lÃ³gica de total diferente. Verifique se os dados abaixo
Â  Â  // (subtotal, descontos, total, dias) estÃ£o realmente sendo preenchidos no HTML.

Â  Â  // --- MONTAR OBJETO PARA ENVIAR Ã€ TELA DE CONFIRMAÃ‡ÃƒO ---
Â  Â  const reserva = {
Â  Â  Â  Â  // Converte a data selecionada (string ISO com T00:00:00.000Z) para um formato yyyy-mm-ddT HH:MM:00
Â  Â  Â  Â  entrada: `${selected.start.toISOString().split('T')[0]}T${timeIn}:00`,
Â  Â  Â  Â  saida: `${selected.end.toISOString().split('T')[0]}T${timeOut}:00`,
Â  Â  Â  Â  subtotal: document.getElementById("subtotal").innerText,
Â  Â  Â  Â  descontos: document.getElementById("discountVal").innerText,
Â  Â  Â  Â  total: document.getElementById("totalPrice").innerText,
Â  Â  Â  Â  dias: document.getElementById("numDays").innerText,
Â  Â  Â  Â  cupom: activeDiscounts.couponCode || "",
Â  Â  Â  Â  porto: activeDiscounts.porto ? "sim" : "nao"
Â  Â  };

Â  Â  // Incluindo o tipo de vaga, jÃ¡ que a versÃ£o anterior incluÃ­a e pode ser necessÃ¡rio
Â  Â  const vagaEl = document.getElementById('vagaType');
Â  Â  const vaga = vagaEl ? vagaEl.value : 'Normal';
Â  Â  reserva.tipoVaga = vaga;


Â  Â  // --- OVERLAY DE LOADING ---
Â  Â  const overlay = document.getElementById("loadingOverlay");
Â  Â  if(overlay) overlay.style.display = "flex";


Â  Â  // --- SIMULAR PROCESSAMENTO ---
Â  Â  setTimeout(() => {
Â  Â  Â  Â  // Criar querystring
Â  Â  Â  Â  const params = new URLSearchParams(reserva).toString();

Â  Â  Â  Â  // Redirecionar
Â  Â  Â  Â  window.location.href = "confirmaÃ§Ã£o.html?" + params;

Â  Â  }, 1100);
Â  }


Â  // --- UI: inject vagaType select if not present ---
Â  function ensureVagaSelector(){
Â  Â  if(document.getElementById('vagaType')) return;
Â  Â  const controls = document.querySelector('.controls');
Â  Â  if(!controls) return;
Â  Â  const wrapper = document.createElement('div');
Â  Â  wrapper.className = 'control-card';
Â  Â  wrapper.setAttribute('aria-label','Tipo de Vaga');
Â  Â  wrapper.innerHTML = `
Â  Â  Â  <div class="info-label">Tipo de Vaga</div>
Â  Â  Â  <div style="display:flex;flex-direction:column;gap:10px;margin-top:8px;">
Â  Â  Â  Â  <select id="vagaType" class="select" aria-label="Tipo de vaga">
Â  Â  Â  Â  Â  <option value="Normal">Normal</option>
Â  Â  Â  Â  Â  <option value="PCD">PCD</option>
Â  Â  Â  Â  </select>
Â  Â  Â  </div>
Â  Â  `;
Â  Â  // append at the end of controls
Â  Â  controls.appendChild(wrapper);
Â  }

Â  // --- Small helper to make sure we don't error out if an expected element is missing ---
Â  function safeInit(){
Â  Â  populateTimes();
Â  Â  ensureVagaSelector();
Â  Â  initializeFromUrl();
Â  Â  renderCalendar();
Â  Â  recalcPrice();
Â  }

Â  // --- Populate times function declared earlier dependency (re-declaration) ---
Â  function populateTimes(){
Â  Â  const timeIn = document.getElementById('timeIn');
Â  Â  const timeOut = document.getElementById('timeOut');
Â  Â  if(!timeIn || !timeOut) return;
Â  Â  // clear existing
Â  Â  timeIn.innerHTML = '';
Â  Â  timeOut.innerHTML = '';
Â  Â  for(let h=0; h<24; h++){
Â  Â  Â  for(let m=0; m<60; m+=30){
Â  Â  Â  Â  const t = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
Â  Â  Â  Â  const o1 = document.createElement('option'); o1.value = t; o1.textContent = t;
Â  Â  Â  Â  const o2 = document.createElement('option'); o2.value = t; o2.textContent = t;
Â  Â  Â  Â  timeIn.appendChild(o1);
Â  Â  Â  Â  timeOut.appendChild(o2);
Â  Â  Â  }
Â  Â  }
Â  Â  timeIn.value = selected.timeIn;
Â  Â  timeOut.value = selected.timeOut;
Â  Â  timeIn.addEventListener('change', ()=> selected.timeIn = timeIn.value);
Â  Â  timeOut.addEventListener('change', ()=> selected.timeOut = timeOut.value);
Â  }

Â  // Event Listener (Adicionado aqui conforme sua solicitaÃ§Ã£o)
Â  document.getElementById("reserveBtn").addEventListener("click", finalizarReserva);

Â  // --- Start ---
Â  safeInit();

})();
</script>


<script>
document.getElementById("reserveBtn").addEventListener("click", function () {

    const subtotal   = document.getElementById("subtotal").innerText;
    const descontos  = document.getElementById("discountVal").innerText;
    const totalFinal = document.getElementById("totalPrice").innerText;

    // Salvar no localStorage
    localStorage.setItem("reserva_subtotal", subtotal);
    localStorage.setItem("reserva_descontos", descontos);
    localStorage.setItem("reserva_total", totalFinal);

    // Redirecionar para confirmaÃ§Ã£o
    window.location.href = "confirmaÃ§Ã£o.html";
});
</script>



</script>
</body>
</html>